<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Class AgentContext | VulcanAI </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Class AgentContext | VulcanAI ">
      
      <meta name="description" content="Represents the context of an agent, including its system prompt, conversation history, and context fields. The context manages token limits by removing older messages when needed to stay within the maximum token count.">
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/StevenGann/VulcanAI/new/main/apiSpec/new?filename=VulcanAI_Core_Agent_AgentContext.md&amp;value=---%0Auid%3A%20VulcanAI.Core.Agent.AgentContext%0Asummary%3A%20&#39;*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax&#39;%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="ManagedReference">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="VulcanAI">
            VulcanAI
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="VulcanAI.Core.Agent.AgentContext">



  <h1 id="VulcanAI_Core_Agent_AgentContext" data-uid="VulcanAI.Core.Agent.AgentContext" class="text-break">
Class AgentContext  <a class="header-action link-secondary" title="View source" href="https://github.com/StevenGann/VulcanAI/blob/main/VulcanAI/Core/Agent/AgentContext.cs/#L20"><i class="bi bi-code-slash"></i></a>
  </h1>

  <div class="facts text-secondary">
    <dl><dt>Namespace</dt><dd><a class="xref" href="VulcanAI.html">VulcanAI</a>.<a class="xref" href="VulcanAI.Core.html">Core</a>.<a class="xref" href="VulcanAI.Core.Agent.html">Agent</a></dd></dl>
  <dl><dt>Assembly</dt><dd>VulcanAI.dll</dd></dl>
  </div>

  <div class="markdown summary"><p>Represents the context of an agent, including its system prompt, conversation history, and context fields.
The context manages token limits by removing older messages when needed to stay within the maximum token count.</p>
</div>
  <div class="markdown conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public class AgentContext</code></pre>
  </div>




  <dl class="typelist inheritance">
    <dt>Inheritance</dt>
    <dd>
      <div><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object">object</a></div>
      <div><span class="xref">AgentContext</span></div>
    </dd>
  </dl>



  <dl class="typelist inheritedMembers">
    <dt>Inherited Members</dt>
    <dd>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.equals#system-object-equals(system-object)">object.Equals(object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.equals#system-object-equals(system-object-system-object)">object.Equals(object, object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.gethashcode">object.GetHashCode()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.gettype">object.GetType()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.memberwiseclone">object.MemberwiseClone()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.referenceequals">object.ReferenceEquals(object, object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.tostring">object.ToString()</a>
    </div>
  </dd></dl>






  <h2 class="section" id="constructors">Constructors
</h2>


  <a id="VulcanAI_Core_Agent_AgentContext__ctor_" data-uid="VulcanAI.Core.Agent.AgentContext.#ctor*"></a>

  <h3 id="VulcanAI_Core_Agent_AgentContext__ctor_System_String_Microsoft_Extensions_Logging_ILogger_VulcanAI_Core_Agent_AgentContext__System_Collections_Generic_Dictionary_System_String_System_String__" data-uid="VulcanAI.Core.Agent.AgentContext.#ctor(System.String,Microsoft.Extensions.Logging.ILogger{VulcanAI.Core.Agent.AgentContext},System.Collections.Generic.Dictionary{System.String,System.String})">
  AgentContext(string, ILogger&lt;AgentContext&gt;, Dictionary&lt;string, string&gt;?)
  <a class="header-action link-secondary" title="View source" href="https://github.com/StevenGann/VulcanAI/blob/main/VulcanAI/Core/Agent/AgentContext.cs/#L74"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Initializes a new instance of the <a class="xref" href="VulcanAI.Core.Agent.AgentContext.html">AgentContext</a> class.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public AgentContext(string systemPrompt, ILogger&lt;AgentContext&gt; logger, Dictionary&lt;string, string&gt;? initialContextFields = null)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>systemPrompt</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a></dt>
    <dd><p>The system prompt that defines the agent's behavior and personality.</p>
</dd>
    <dt><code>logger</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/microsoft.extensions.logging.ilogger-1">ILogger</a>&lt;<a class="xref" href="VulcanAI.Core.Agent.AgentContext.html">AgentContext</a>&gt;</dt>
    <dd><p>The logger instance for recording diagnostic information.</p>
</dd>
    <dt><code>initialContextFields</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.collections.generic.dictionary-2">Dictionary</a>&lt;<a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a>, <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a>&gt;</dt>
    <dd><p>Optional initial context fields for the agent.</p>
</dd>
  </dl>








  <h4 class="section" id="VulcanAI_Core_Agent_AgentContext__ctor_System_String_Microsoft_Extensions_Logging_ILogger_VulcanAI_Core_Agent_AgentContext__System_Collections_Generic_Dictionary_System_String_System_String___remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>The system prompt is required and cannot be changed after creation.
Context fields can be added, modified, or removed at any time.</p>
</div>




  <h2 class="section" id="properties">Properties
</h2>


  <a id="VulcanAI_Core_Agent_AgentContext_ContextFields_" data-uid="VulcanAI.Core.Agent.AgentContext.ContextFields*"></a>

  <h3 id="VulcanAI_Core_Agent_AgentContext_ContextFields" data-uid="VulcanAI.Core.Agent.AgentContext.ContextFields">
  ContextFields
  <a class="header-action link-secondary" title="View source" href="https://github.com/StevenGann/VulcanAI/blob/main/VulcanAI/Core/Agent/AgentContext.cs/#L62"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Gets the context fields as a read-only dictionary.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public IReadOnlyDictionary&lt;string, string&gt; ContextFields { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.collections.generic.ireadonlydictionary-2">IReadOnlyDictionary</a>&lt;<a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a>, <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a>&gt;</dt>
    <dd></dd>
  </dl>




  <h4 class="section" id="VulcanAI_Core_Agent_AgentContext_ContextFields_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>Context fields are used to store additional information that can be referenced
in prompts and responses. They are always included in the context and are not
affected by the token limit.</p>
</div>




  <a id="VulcanAI_Core_Agent_AgentContext_ConversationHistory_" data-uid="VulcanAI.Core.Agent.AgentContext.ConversationHistory*"></a>

  <h3 id="VulcanAI_Core_Agent_AgentContext_ConversationHistory" data-uid="VulcanAI.Core.Agent.AgentContext.ConversationHistory">
  ConversationHistory
  <a class="header-action link-secondary" title="View source" href="https://github.com/StevenGann/VulcanAI/blob/main/VulcanAI/Core/Agent/AgentContext.cs/#L52"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Gets the conversation history as a read-only array of messages.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public Message[] ConversationHistory { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="VulcanAI.Core.Interfaces.Message.html">Message</a>[]</dt>
    <dd></dd>
  </dl>




  <h4 class="section" id="VulcanAI_Core_Agent_AgentContext_ConversationHistory_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>The conversation history includes all messages sent and received by the agent.
When serializing to JSON, older messages may be removed to stay within the token limit.</p>
</div>




  <a id="VulcanAI_Core_Agent_AgentContext_MaxTokens_" data-uid="VulcanAI.Core.Agent.AgentContext.MaxTokens*"></a>

  <h3 id="VulcanAI_Core_Agent_AgentContext_MaxTokens" data-uid="VulcanAI.Core.Agent.AgentContext.MaxTokens">
  MaxTokens
  <a class="header-action link-secondary" title="View source" href="https://github.com/StevenGann/VulcanAI/blob/main/VulcanAI/Core/Agent/AgentContext.cs/#L34"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Gets or sets the maximum number of tokens allowed in the context.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public int MaxTokens { get; set; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd></dd>
  </dl>




  <h4 class="section" id="VulcanAI_Core_Agent_AgentContext_MaxTokens_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>This value is used to limit the size of the context when serializing to JSON.
When the context exceeds this limit, older messages are removed from the conversation history
until the context is within the limit. The default value is 4096 tokens.</p>
</div>




  <a id="VulcanAI_Core_Agent_AgentContext_SystemPrompt_" data-uid="VulcanAI.Core.Agent.AgentContext.SystemPrompt*"></a>

  <h3 id="VulcanAI_Core_Agent_AgentContext_SystemPrompt" data-uid="VulcanAI.Core.Agent.AgentContext.SystemPrompt">
  SystemPrompt
  <a class="header-action link-secondary" title="View source" href="https://github.com/StevenGann/VulcanAI/blob/main/VulcanAI/Core/Agent/AgentContext.cs/#L43"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Gets the system prompt that defines the agent's behavior and personality.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public string SystemPrompt { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a></dt>
    <dd></dd>
  </dl>




  <h4 class="section" id="VulcanAI_Core_Agent_AgentContext_SystemPrompt_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>The system prompt is always included in the context and is not affected by the token limit.
It should be concise but descriptive enough to guide the agent's behavior.</p>
</div>




  <h2 class="section" id="methods">Methods
</h2>


  <a id="VulcanAI_Core_Agent_AgentContext_AddMessage_" data-uid="VulcanAI.Core.Agent.AgentContext.AddMessage*"></a>

  <h3 id="VulcanAI_Core_Agent_AgentContext_AddMessage_VulcanAI_Core_Interfaces_Message_" data-uid="VulcanAI.Core.Agent.AgentContext.AddMessage(VulcanAI.Core.Interfaces.Message)">
  AddMessage(Message)
  <a class="header-action link-secondary" title="View source" href="https://github.com/StevenGann/VulcanAI/blob/main/VulcanAI/Core/Agent/AgentContext.cs/#L90"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Adds a message to the conversation history.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public void AddMessage(Message message)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>message</code> <a class="xref" href="VulcanAI.Core.Interfaces.Message.html">Message</a></dt>
    <dd><p>The message to add.</p>
</dd>
  </dl>








  <h4 class="section" id="VulcanAI_Core_Agent_AgentContext_AddMessage_VulcanAI_Core_Interfaces_Message__remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>Messages are added to the end of the conversation history.
When serializing to JSON, older messages may be removed to stay within the token limit.</p>
</div>




  <a id="VulcanAI_Core_Agent_AgentContext_FromJson_" data-uid="VulcanAI.Core.Agent.AgentContext.FromJson*"></a>

  <h3 id="VulcanAI_Core_Agent_AgentContext_FromJson_System_String_Microsoft_Extensions_Logging_ILogger_VulcanAI_Core_Agent_AgentContext__" data-uid="VulcanAI.Core.Agent.AgentContext.FromJson(System.String,Microsoft.Extensions.Logging.ILogger{VulcanAI.Core.Agent.AgentContext})">
  FromJson(string, ILogger&lt;AgentContext&gt;)
  <a class="header-action link-secondary" title="View source" href="https://github.com/StevenGann/VulcanAI/blob/main/VulcanAI/Core/Agent/AgentContext.cs/#L205"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Creates a new context from a JSON string.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public static AgentContext FromJson(string json, ILogger&lt;AgentContext&gt; logger)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>json</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a></dt>
    <dd><p>The JSON string to deserialize.</p>
</dd>
    <dt><code>logger</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/microsoft.extensions.logging.ilogger-1">ILogger</a>&lt;<a class="xref" href="VulcanAI.Core.Agent.AgentContext.html">AgentContext</a>&gt;</dt>
    <dd><p>The logger instance for recording diagnostic information.</p>
</dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="VulcanAI.Core.Agent.AgentContext.html">AgentContext</a></dt>
    <dd><p>A new instance of <a class="xref" href="VulcanAI.Core.Agent.AgentContext.html">AgentContext</a> with the deserialized data.</p>
</dd>
  </dl>







  <h4 class="section" id="VulcanAI_Core_Agent_AgentContext_FromJson_System_String_Microsoft_Extensions_Logging_ILogger_VulcanAI_Core_Agent_AgentContext___remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>The JSON string should be in the format produced by the <a class="xref" href="VulcanAI.Core.Agent.AgentContext.html#VulcanAI_Core_Agent_AgentContext_ToJson">ToJson()</a> method.
The deserialized context will have the same system prompt, context fields, and conversation history
as the original context, subject to the token limit.</p>
</div>

  <h4 class="section">Exceptions</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.invalidoperationexception">InvalidOperationException</a></dt>
    <dd><p>Thrown when the JSON cannot be deserialized into an AgentContext.</p>
</dd>
  </dl>



  <a id="VulcanAI_Core_Agent_AgentContext_GetContextField_" data-uid="VulcanAI.Core.Agent.AgentContext.GetContextField*"></a>

  <h3 id="VulcanAI_Core_Agent_AgentContext_GetContextField_System_String_" data-uid="VulcanAI.Core.Agent.AgentContext.GetContextField(System.String)">
  GetContextField(string)
  <a class="header-action link-secondary" title="View source" href="https://github.com/StevenGann/VulcanAI/blob/main/VulcanAI/Core/Agent/AgentContext.cs/#L119"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Gets a context field value.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public string? GetContextField(string key)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>key</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a></dt>
    <dd><p>The key of the context field.</p>
</dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a></dt>
    <dd><p>The value of the context field, or null if not found.</p>
</dd>
  </dl>







  <h4 class="section" id="VulcanAI_Core_Agent_AgentContext_GetContextField_System_String__remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>Context fields are used to store additional information that can be referenced
in prompts and responses. They are always included in the context and are not
affected by the token limit.</p>
</div>




  <a id="VulcanAI_Core_Agent_AgentContext_GetTokenCount_" data-uid="VulcanAI.Core.Agent.AgentContext.GetTokenCount*"></a>

  <h3 id="VulcanAI_Core_Agent_AgentContext_GetTokenCount_System_String_" data-uid="VulcanAI.Core.Agent.AgentContext.GetTokenCount(System.String)">
  GetTokenCount(string)
  <a class="header-action link-secondary" title="View source" href="https://github.com/StevenGann/VulcanAI/blob/main/VulcanAI/Core/Agent/AgentContext.cs/#L285"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Calculates the token count for a given text string.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public int GetTokenCount(string text)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>text</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a></dt>
    <dd><p>The text to calculate tokens for.</p>
</dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd><p>The number of tokens in the text.</p>
</dd>
  </dl>







  <h4 class="section" id="VulcanAI_Core_Agent_AgentContext_GetTokenCount_System_String__remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>This method uses a more accurate token estimation based on the actual tokenization used by language models:</p>
<ul>
<li>Words are split into subwords using common patterns</li>
<li>Punctuation is generally part of the same token as the word</li>
<li>Numbers are generally part of the same token as the word</li>
<li>Special characters and whitespace are counted separately</li>
</ul>
</div>




  <a id="VulcanAI_Core_Agent_AgentContext_GetTokenCount_" data-uid="VulcanAI.Core.Agent.AgentContext.GetTokenCount*"></a>

  <h3 id="VulcanAI_Core_Agent_AgentContext_GetTokenCount_VulcanAI_Core_AgentContextData_" data-uid="VulcanAI.Core.Agent.AgentContext.GetTokenCount(VulcanAI.Core.AgentContextData)">
  GetTokenCount(AgentContextData)
  <a class="header-action link-secondary" title="View source" href="https://github.com/StevenGann/VulcanAI/blob/main/VulcanAI/Core/Agent/AgentContext.cs/#L342"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Calculates the token count for a given context data object.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public int GetTokenCount(AgentContextData contextData)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>contextData</code> <a class="xref" href="VulcanAI.Core.AgentContextData.html">AgentContextData</a></dt>
    <dd><p>The context data to calculate tokens for.</p>
</dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd><p>The total number of tokens in the context data.</p>
</dd>
  </dl>







  <h4 class="section" id="VulcanAI_Core_Agent_AgentContext_GetTokenCount_VulcanAI_Core_AgentContextData__remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>This method calculates tokens for:</p>
<ol>
<li>The system prompt</li>
<li>All context fields (key + value)</li>
<li>All messages in the conversation history</li>
<li>JSON structure overhead (estimated based on actual JSON structure)</li>
</ol>
</div>




  <a id="VulcanAI_Core_Agent_AgentContext_RemoveContextField_" data-uid="VulcanAI.Core.Agent.AgentContext.RemoveContextField*"></a>

  <h3 id="VulcanAI_Core_Agent_AgentContext_RemoveContextField_System_String_" data-uid="VulcanAI.Core.Agent.AgentContext.RemoveContextField(System.String)">
  RemoveContextField(string)
  <a class="header-action link-secondary" title="View source" href="https://github.com/StevenGann/VulcanAI/blob/main/VulcanAI/Core/Agent/AgentContext.cs/#L134"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Removes a context field.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public bool RemoveContextField(string key)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>key</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a></dt>
    <dd><p>The key of the context field to remove.</p>
</dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.boolean">bool</a></dt>
    <dd><p>True if the field was removed, false if it didn't exist.</p>
</dd>
  </dl>







  <h4 class="section" id="VulcanAI_Core_Agent_AgentContext_RemoveContextField_System_String__remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>Context fields are used to store additional information that can be referenced
in prompts and responses. They are always included in the context and are not
affected by the token limit.</p>
</div>




  <a id="VulcanAI_Core_Agent_AgentContext_SetContextField_" data-uid="VulcanAI.Core.Agent.AgentContext.SetContextField*"></a>

  <h3 id="VulcanAI_Core_Agent_AgentContext_SetContextField_System_String_System_String_" data-uid="VulcanAI.Core.Agent.AgentContext.SetContextField(System.String,System.String)">
  SetContextField(string, string)
  <a class="header-action link-secondary" title="View source" href="https://github.com/StevenGann/VulcanAI/blob/main/VulcanAI/Core/Agent/AgentContext.cs/#L104"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Sets a context field value.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public void SetContextField(string key, string value)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>key</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a></dt>
    <dd><p>The key of the context field.</p>
</dd>
    <dt><code>value</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a></dt>
    <dd><p>The value to set.</p>
</dd>
  </dl>








  <h4 class="section" id="VulcanAI_Core_Agent_AgentContext_SetContextField_System_String_System_String__remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>If the key already exists, its value will be updated.
Context fields are always included in the context and are not affected by the token limit.</p>
</div>




  <a id="VulcanAI_Core_Agent_AgentContext_ToJson_" data-uid="VulcanAI.Core.Agent.AgentContext.ToJson*"></a>

  <h3 id="VulcanAI_Core_Agent_AgentContext_ToJson" data-uid="VulcanAI.Core.Agent.AgentContext.ToJson">
  ToJson()
  <a class="header-action link-secondary" title="View source" href="https://github.com/StevenGann/VulcanAI/blob/main/VulcanAI/Core/Agent/AgentContext.cs/#L151"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Serializes the context to a JSON string, respecting the maximum token limit.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public string ToJson()</code></pre>
  </div>


  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a></dt>
    <dd><p>A JSON string representing the context, with older messages removed if necessary to stay within token limits.</p>
</dd>
  </dl>







  <h4 class="section" id="VulcanAI_Core_Agent_AgentContext_ToJson_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>The serialized context includes:</p>
<ol>
<li>The system prompt</li>
<li>Any context fields</li>
<li>The conversation history (with older messages removed if needed to stay within token limits)
The token limit is enforced by removing older messages from the conversation history
until the context is within the limit. The system prompt and context fields are always included.</li>
</ol>
</div>





</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/StevenGann/VulcanAI/blob/main/VulcanAI/Core/Agent/AgentContext.cs/#L20" class="edit-link">Edit this page</a>
        </div>


      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
